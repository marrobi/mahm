{% extends 'layout-app.html' %}

{% set hub = "Your health" %}
{% set pageHeading = "U&E blood test results" %}

{% block beforeContent %}
  {{ backLink({
    text: "Back to My BP",
    href: "/pages/mybp/index"
  }) }}
{% endblock %}

{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

      {{ dynamicPageTitle({
        title: pageHeading,
        titleSecondary: true
      })}}

      {{ summaryList({
        classes: "nhsuk-u-margin-bottom-4",
        rows: [
        {
          key: {
            text: "Test date"
          },
          value: {
            html: "15 November 2024"
          }
        },
        {
          key: {
            text: "Healthcare professional's comment"
          },
          value: {
            html: "AI system has reviewed results and adjusted treatment plan"
          }
        },
        {
          key: {
            text: "Next test due"
          },
          value: {
            html: "29 November 2024 (2 weeks - routine monitoring)"
          }
        }
        ]
      }) }}

      <div class="nhsuk-notification-banner" role="region" aria-labelledby="notification-banner-title">
        <div class="nhsuk-notification-banner__header">
          <h2 class="nhsuk-notification-banner__title" id="notification-banner-title">
            Treatment plan updated
          </h2>
        </div>
        <div class="nhsuk-notification-banner__content">
          <p class="nhsuk-notification-banner__heading">
            Your AI care team has reviewed your results
          </p>
          <p>Based on your U&E test results, our AI system has made adjustments to your treatment plan following NICE guidelines. Your GP has been notified.</p>
        </div>
      </div>

      <p><a href="#ue-info">What is a U&E blood test?</a></p>

      <hr class="nhsuk-section-break nhsuk-section-break--l nhsuk-section-break--visible app-section-break--width-8">

      <h2>Your results</h2>

      <hr class="nhsuk-section-break nhsuk-section-break--l nhsuk-section-break--visible app-section-break--width-4">

      <!-- Creatinine - Slightly elevated -->
      <h3>Creatinine: <span class="nhsuk-u-display-block"><span class="nhsuk-tag nhsuk-tag--yellow">125 Î¼mol/L</span></span></h3>
      <p>The reference range is between 60 to 120 Î¼mol/L.</p>
      <div class="nhsuk-u-margin-bottom-3">
        <strong>Change from baseline:</strong> <span class="nhsuk-tag nhsuk-tag--yellow">Slight increase</span> (was 95 Î¼mol/L in July 2024)
      </div>
      <hr class="nhsuk-section-break nhsuk-section-break--visible">
      <div class="nhsuk-grid-row nhsuk-u-margin-bottom-2">
        <div class="nhsuk-grid-column-full">
          <div style="background: #f0f4f5; padding: 12px; border-radius: 4px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
              <span style="font-size: 12px; color: #425563;">Low</span>
              <span style="font-size: 12px; color: #425563;">Normal</span>
              <span style="font-size: 12px; color: #425563;">High</span>
            </div>
            <div style="height: 20px; background: linear-gradient(to right, #d5281b 0%, #d5281b 25%, #00a499 25%, #00a499 75%, #d5281b 75%, #d5281b 100%); border-radius: 4px; position: relative;">
              <div style="position: absolute; top: -5px; right: 20%; width: 2px; height: 30px; background: #003087;"></div>
              <div style="position: absolute; top: 25px; right: 15%; font-size: 12px; color: #003087; font-weight: bold;">Your result: 125</div>
            </div>
          </div>
        </div>
      </div>
      <hr class="nhsuk-section-break nhsuk-section-break--m nhsuk-section-break--visible">
      <h4>What this means</h4>
      <p><strong>This result is slightly above the normal range.</strong> The small increase suggests your kidneys are working harder but function remains adequate. This level allows for safe medication adjustments.</p>

      <hr class="nhsuk-section-break nhsuk-section-break--l nhsuk-section-break--visible app-section-break--width-4">

      <!-- Potassium - Normal -->
      <h3>Potassium: <span class="nhsuk-u-display-block"><span class="nhsuk-tag nhsuk-tag--green">4.2 mmol/L</span></span></h3>
      <p>The reference range is between 3.5 to 5.0 mmol/L.</p>
      <div class="nhsuk-u-margin-bottom-3">
        <strong>Change from baseline:</strong> <span class="nhsuk-tag nhsuk-tag--white">Stable</span> (was 4.1 mmol/L in July 2024)
      </div>
      <hr class="nhsuk-section-break nhsuk-section-break--visible">
      <div class="nhsuk-grid-row nhsuk-u-margin-bottom-2">
        <div class="nhsuk-grid-column-full">
          <div style="background: #f0f4f5; padding: 12px; border-radius: 4px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
              <span style="font-size: 12px; color: #425563;">Low</span>
              <span style="font-size: 12px; color: #425563;">Normal</span>
              <span style="font-size: 12px; color: #425563;">High</span>
            </div>
            <div style="height: 20px; background: linear-gradient(to right, #d5281b 0%, #d5281b 25%, #00a499 25%, #00a499 75%, #d5281b 75%, #d5281b 100%); border-radius: 4px; position: relative;">
              <div style="position: absolute; top: -5px; left: 45%; width: 2px; height: 30px; background: #003087;"></div>
              <div style="position: absolute; top: 25px; left: 40%; font-size: 12px; color: #003087; font-weight: bold;">Your result: 4.2</div>
            </div>
          </div>
        </div>
      </div>
      <hr class="nhsuk-section-break nhsuk-section-break--m nhsuk-section-break--visible">
      <h4>What this means</h4>
      <p>Your potassium level is normal and stable. This allows safe use of ACE inhibitors without risk of dangerous potassium elevation.</p>

      <hr class="nhsuk-section-break nhsuk-section-break--l nhsuk-section-break--visible app-section-break--width-4">

      <!-- AI Decision Section -->
      <div class="nhsuk-care-card nhsuk-care-card--immediate">
        <div class="nhsuk-care-card__heading-container">
          <h3 class="nhsuk-care-card__heading">
            <span role="img" aria-label="Information">ðŸ¤–</span>AI Treatment Decision
          </h3>
        </div>
        <div class="nhsuk-care-card__content">
          <h4>Original plan vs. AI decision</h4>
          
          <div style="background: #fff2cc; border: 1px solid #ffeb3b; padding: 16px; border-radius: 4px; margin-bottom: 16px;">
            <h5>Original plan (before results):</h5>
            <p><strong>Increase Amlodipine</strong> from 5mg to 10mg daily due to BP readings of 142/88 mmHg</p>
          </div>

          <div style="background: #e8f5e8; border: 1px solid #4caf50; padding: 16px; border-radius: 4px; margin-bottom: 16px;">
            <h5>AI system decision (after reviewing U&E results):</h5>
            <p><strong>Add Ramipril</strong> 2.5mg daily instead of increasing Amlodipine</p>
          </div>

          <h4>NICE guideline rationale</h4>
          <p>According to <strong>NICE Guideline NG136 (Hypertension in adults)</strong>:</p>
          <ul>
            <li>Your kidney function (creatinine 125 Î¼mol/L) is adequate for ACE inhibitor use</li>
            <li>Potassium level (4.2 mmol/L) allows safe ACE inhibitor initiation</li>
            <li>Step 2 treatment recommends adding ACE inhibitor to calcium channel blocker</li>
            <li>Combination therapy often more effective than single drug dose increases</li>
          </ul>

          <h4>Your new medication plan</h4>
          <div class="nhsuk-table-responsive">
            <table class="nhsuk-table">
              <caption class="nhsuk-table__caption">Updated medication schedule</caption>
              <thead role="rowgroup" class="nhsuk-table__head">
                <tr role="row">
                  <th role="columnheader" scope="col">Medication</th>
                  <th role="columnheader" scope="col">Dose</th>
                  <th role="columnheader" scope="col">When to take</th>
                  <th role="columnheader" scope="col">Start date</th>
                </tr>
              </thead>
              <tbody class="nhsuk-table__body">
                <tr role="row" class="nhsuk-table__row">
                  <td class="nhsuk-table__cell">Amlodipine</td>
                  <td class="nhsuk-table__cell">5mg</td>
                  <td class="nhsuk-table__cell">Once daily (continue)</td>
                  <td class="nhsuk-table__cell">Already taking</td>
                </tr>
                <tr role="row" class="nhsuk-table__row">
                  <td class="nhsuk-table__cell"><strong>Ramipril (NEW)</strong></td>
                  <td class="nhsuk-table__cell"><strong>2.5mg</strong></td>
                  <td class="nhsuk-table__cell"><strong>Once daily</strong></td>
                  <td class="nhsuk-table__cell"><strong>17 November 2024</strong></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="nhsuk-warning-callout">
            <h3 class="nhsuk-warning-callout__label">
              <span role="img" aria-label="Warning">ðŸ“‹</span>
              Next steps
            </h3>
            <p><strong>Your prescription has been sent to your nominated pharmacy.</strong><br>
            You can collect your new Ramipril prescription from tomorrow.<br>
            Continue taking your Amlodipine as normal.</p>
          </div>

          <h4>Monitoring plan</h4>
          <ul>
            <li><strong>Next BP check:</strong> In 2 weeks (monitor response to new medication)</li>
            <li><strong>Next U&E test:</strong> In 2 weeks (ensure kidney function stable with ACE inhibitor)</li>
            <li><strong>Target BP:</strong> &lt;140/90 mmHg (expected within 4-6 weeks)</li>
          </ul>
        </div>
      </div>

      <!-- Information sections -->
      <div class="nhsuk-expander-group">
        <details class="nhsuk-details nhsuk-expander" id="ue-info">
          <summary class="nhsuk-details__summary">
            <span class="nhsuk-details__summary-text">
              What is a U&E blood test?
            </span>
          </summary>
          <div class="nhsuk-details__text">
            <p>U&E stands for "Urea and Electrolytes". This blood test measures several important chemicals in your blood that help us monitor your kidney function and ensure your blood pressure medications are safe.</p>
            <ul>
              <li><strong>Creatinine:</strong> A waste product that your kidneys filter out</li>
              <li><strong>Potassium:</strong> Essential for heart rhythm and muscle function</li>
              <li><strong>Sodium:</strong> Important for fluid balance</li>
              <li><strong>Urea:</strong> Another waste product filtered by kidneys</li>
            </ul>
            <p>Regular monitoring ensures your treatment remains safe and effective.</p>
          </div>
        </details>

        <details class="nhsuk-details nhsuk-expander">
          <summary class="nhsuk-details__summary">
            <span class="nhsuk-details__summary-text">
              How does the AI system make treatment decisions?
            </span>
          </summary>
          <div class="nhsuk-details__text">
            <p>Our AI system follows a structured approach based on clinical guidelines:</p>
            <ol>
              <li><strong>Analyses your test results</strong> against normal ranges</li>
              <li><strong>Reviews NICE guidelines</strong> for hypertension management</li>
              <li><strong>Considers your medical history</strong> and current medications</li>
              <li><strong>Calculates risk-benefit ratio</strong> of different treatment options</li>
              <li><strong>Makes evidence-based recommendations</strong> following clinical protocols</li>
              <li><strong>Alerts your GP</strong> of all decisions for oversight</li>
            </ol>
            <p>All AI decisions are reviewed by healthcare professionals to ensure patient safety.</p>
          </div>
        </details>
      </div>

      <div class="nhsuk-action-link nhsuk-u-margin-top-4">
        <a class="nhsuk-action-link__link" href="/pages/mybp/index">
          <svg class="nhsuk-icon nhsuk-icon__arrow-right-circle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" width="36" height="36">
            <path d="m0 0h24v24h-24z" fill="none"/>
            <path d="m12 2a10 2 1 0 10 10 10.011 10.011 0 0 0 -10-10zm5.293 11.293-3.293 3.293v-8.586l3.293 3.293a1 1 0 0 1 0 1.414z"/>
          </svg>
          <span class="nhsuk-action-link__text">Return to My BP dashboard</span>
        </a>
      </div>

    </div>
  </div>
{% endblock %}